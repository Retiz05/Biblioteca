@model IEnumerable<Biblioteca.Models.Usuario>

@{
    ViewBag.Title = "Lista de Usuarios";
    Layout = "~/Views/Shared/_LayoutCliente.cshtml";
    var showModal = TempData["ShowModal"] as string;
    var modalTitle = TempData["ModalTitle"] as string;
    var alertMessage = TempData["AlertMessage"] as string;
    var alertType = TempData["AlertType"] as string;
    var userModel = TempData["UserModel"] as Biblioteca.Models.Usuario;
}

<!-- Enlaces a dependencias -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="~/Content/sweetalert2.min.css" />

<style>
    body {
        background-color: #f4f6f9;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    h2 {
        color: #2f3e4d;
        font-weight: 600;
        margin-bottom: 1.5rem;
    }

    .table-container {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        padding: 20px;
        margin-bottom: 2rem;
    }

    .table thead {
        background-color: #007bff;
        color: white;
    }

    .table th, .table td {
        vertical-align: middle;
    }

    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        display: @(showModal == "true" ? "flex" : "none");
        align-items: center;
        justify-content: center;
        z-index: 2000;
    }

    .modal-form {
        background: #fff;
        padding: 30px;
        border-radius: 12px;
        width: 100%;
        max-width: 500px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        position: relative;
        animation: fadeIn 0.3s ease;
    }

        .modal-form h2 {
            margin-top: 0;
            font-size: 1.75rem;
            color: #2f3e4d;
            margin-bottom: 20px;
        }

    .form-group {
        margin-bottom: 1.5rem;
    }

        .form-group label {
            font-weight: 500;
            color: #2d3748;
            font-size: 0.95rem;
        }

    .form-control {
        border-radius: 8px;
        border: 1px solid #d1d5db;
        background-color: #f8fafc;
        transition: all 0.2s ease;
    }

        .form-control:focus {
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
            background-color: #fff;
        }

    .form-group select {
        appearance: none;
        background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%234a5568' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right 1rem center;
        background-size: 1rem;
        padding-right: 2.5rem;
    }

    .error-message {
        color: #dc3545;
        font-size: 0.85rem;
        margin-top: 0.25rem;
    }

    .form-actions {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
    }

    .btn {
        border-radius: 6px;
        font-weight: 500;
        padding: 10px 20px;
    }

    .close-btn {
        position: absolute;
        top: 15px;
        right: 15px;
        background: transparent;
        border: none;
        font-size: 1.25rem;
        cursor: pointer;
        color: #6b7280;
    }

        .close-btn:hover {
            color: #1f2937;
        }

    @@keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @@media (max-width: 768px) {
        .modal-form {
            width: 90%;
        }
    }
</style>

<h2>Lista de Usuarios</h2>

<div class="table-container">
    <p>
        <a href="@Url.Action("CrearUsuario", "Cliente")" class="btn btn-primary">
            <i class="fas fa-user-plus"></i> Crear Usuario
        </a>
    </p>
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>Nombre</th>
                <th>Correo</th>
                <th>Rol</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            @if (Model != null)
            {
                foreach (var usuario in Model)
                {
                    <tr>
                        <td>@usuario.Nombre</td>
                        <td>@usuario.Correo</td>
                        <td>@(usuario.RolUsuario != null ? usuario.RolUsuario.Nombre : "Sin rol asignado")</td>
                        <td>
                            <a href="@Url.Action("EditarUsuario", "Cliente", new { id = usuario.ID })" class="btn btn-warning btn-sm">
                                <i class="fas fa-edit"></i> Editar
                            </a>
                            <a href="@Url.Action("DeleteUser", "Cliente", new { id = usuario.ID })" class="btn btn-danger btn-sm" onclick="return confirm('¿Estás seguro de eliminar este usuario?');">
                                <i class="fas fa-trash"></i> Eliminar
                            </a>
                        </td>
                    </tr>
                }
            }
            else
            {
                <tr><td colspan="4">No hay usuarios disponibles.</td></tr>
            }
        </tbody>
    </table>
</div>

<!-- Modal para Crear/Editar Usuario -->
<div class="modal-overlay" id="usuarioModal">
    <div class="modal-form">
        <a href="@Url.Action("Usuarios", "Cliente")" class="close-btn">&#10006;</a>
        <h2>@(modalTitle ?? "Crear Usuario")</h2>
        @if (userModel != null)
        {
            @Html.Partial("_UsuarioForm", userModel)
        }
    </div>
</div>

@if (!string.IsNullOrEmpty(alertMessage))
{
    <script src="~/Scripts/sweetalert2.all.min.js"></script>
    <script>
        Swal.fire({
            icon: '@alertType',
            title: '@(alertType == "success" ? "Éxito" : "Error")',
            text: '@alertMessage',
            timer: 3000,
            timerProgressBar: true
        }).then(() => {
            window.location.href = '@Url.Action("Usuarios", "Cliente")';
        });
    </script>
}